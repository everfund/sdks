import{disableBodyScroll as e,clearAllBodyScrollLocks as o,enableBodyScroll as t}from"body-scroll-lock";import n from"element-closest";import"core-js/features/array/includes";import"core-js/features/array/fill";import"core-js/features/promise";import"core-js/features";import"element-remove";import{css as a,keyframes as r}from"goober";var i=new(/*#__PURE__*/function(){function s(){this.donationWidgetOpen=!1,this.onSuccess=function(){},this.onFailure=function(){},this.onClose=function(){},this.version=void 0,this.version="2.0.0",this.setupButtonListeners(),this.setupIframeListeners(),n(window)}var d=s.prototype;return d.modal=function(e){var o=e.code,t=e.domain,n=e.closeOnSuccess,a=e.onSuccess,r=e.onFailure,i=e.onClose;console.warn("everfund.modal is deprecated in the next update, please use everfund.donationWidget instead"),this.donationWidget({code:o,domain:t,closeOnSuccess:n,onSuccess:a,onFailure:r,onClose:i})},d.donationWidget=function(o){var t=o.code,n=o.domain,i=o.closeOnSuccess,s=o.onSuccess,d=o.onFailure,c=o.onClose;s&&(this.onSuccess=s),d&&(this.onFailure=d),c&&(this.onClose=c);var l=window.location.origin,u=function(e){var o=[];for(var t in e)e[t]&&e.hasOwnProperty(t)&&o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")};try{var m=document.createElement("iframe");m.src="https://"+(n||"evr.fund")+"/"+t+"/modal?"+u({embed_origin:l,embeded:!0,close_on_success:i}),m.allowPaymentRequest=!0;var p=a({border:"none",width:"100%",margin:0,height:"100%"});m.id="ef-modal",m.className=p,m.addEventListener("load",function(){var e=document.querySelector(".ldsRing"),o=document.querySelector(".embedModal");null==e||e.remove(),o.style.transform="opacity(1)"});var f=document.createElement("div"),v=a({pointerEvents:"all",zIndex:"9999999",display:"flex",width:"100%",transform:"opacity(0)",transition:"transform 0.3s ease",overflowY:"auto","-webkit-overflow-scrolling":"touch",height:"100%"});f.className="embedModal "+v,f.appendChild(m);var h=document.createElement("div");e(h);var g=document.createElement("div"),b=r({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),y=a({display:"inline-block",position:"absolute",left:"calc(50% - 32px)",top:"calc(50% - 32px)",width:"64px",height:"64px","& div":{boxSizing:"border-box",display:"block",position:"absolute",width:"51px",height:"51px",margin:"6px",border:"6px solid white",borderRadius:"50%",animation:b+" 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite",borderColor:"white transparent transparent transparent"},"& div:nth-child(1)":{animationDelay:" -0.45s"},"& div:nth-child(2)":{animationDelay:" -0.3s"},"& div:nth-child(3)":{animationDelay:" -0.15s"}});g.className="ldsRing "+y;var w=document.createElement("div");Array(4).fill(4).forEach(function(){g.appendChild(w)});var x=a({position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.7)",zIndex:"9999998",display:"flex",justifyContent:"space-around",alignItems:"stretch",backdropFilter:"blur(8px)"});h.className="embedContainer "+x,h.appendChild(g),h.appendChild(f),document.body.appendChild(h)}catch(e){console.log(e),window.location.replace("https://"+(n||"evr.fund")+"/"+t+"/modal?"+u({return_url:l}))}},d.setupButtonListeners=function(){document.addEventListener("click",function(e){var t=e.target.closest("[data-ef-modal]");if(t&&!i.donationWidgetOpen){e.preventDefault(),e.stopPropagation();var n=t.getAttribute("data-ef-modal");n?(new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(n)&&(console.warn("Everfund: url's are deprecated please use a code instead"),n=new URL(n).pathname.replace("/","")),i.donationWidgetOpen=!0,i.donationWidget({code:n,onSuccess:function(){},onFailure:function(){},onClose:function(){o()}})):console.error('Everfund: data-ef-modal is required! eg <button data-ef-modal="rjww"> modal </button>')}},!1)},d.setupIframeListeners=function(){window.addEventListener("message",function(e){var o=document.querySelector(".embedContainer");switch(e.data.message){case"everfund:ready":var n=document.querySelector("#ldsRing"),a=document.querySelector(".embedModal");null==n||n.remove(),a.style.transform="opacity(1)";break;case"everfund:success":i.onSuccess(e.data.content);break;case"everfund:failure":i.onFailure(e.data.content);break;case"everfund:close":o&&t(o),o&&o.remove(),i.donationWidgetOpen=!1,i.onClose()}},!1)},s}());export{i as default};
//# sourceMappingURL=js-sdk.js.map
